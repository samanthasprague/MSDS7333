---
title: "Cherry Blossom Race Case Study"
subtitle: "Quantifying the World - Southern Methodist University"
author: "Solange Garcia de Alford, Eduardo Cantu & Samantha Sprague"
date: "09/23/2019"
output:
  pdf_document:
    number_sections: yes
header-includes: 
  \usepackage{float}
  \usepackage{listings}
  \usepackage{fancyhdr}
  \pagestyle{fancy}
  \fancyhead[L]{\uppercase{DS7333} | CS1 - RTLS}
  \fancyhead[R]{\small Garcia de Alford, Cantu, Sprague}
  \fancypagestyle{plain}{\pagestyle{fancy}}
---
\begin{abstract}
   Fitness trends have changed trendemously over the past 20 years; from zumba to the Peloton, the mediums of fitness have also shifted. The current craze leaves consumers at two polar ends: favoring a classroom environment, or the comfort of their home. Has this shift in consumer preferences negatively impacted the engagement of fitness fanatics in traditional outlets? Or has the rise in popularity led to greater engagement in both traditional and non-traditional exercise? Futhermore, has the demographic of fitness participants been altered with the changes in societal fitness? This paper will explore an in-depth analysis on the participants of Washington D.C's annual Cherry Blossom race to provide data driven insights. 
   
\end{abstract}

# Introduction
The Washington D.C. Cherry Blossom Ten-Mile race is held every April in celebration of the annual cherry tree blossom. The spectacular view brings in thousands of participants who opt to run either a 10k or 5k race. The race has become so popular in recent years, interested participants must be selected from a lottery! [2] For this analysis, race data from the years 1999 to 2012 will be scraped from the Cherry Blossom Race website and analyzed using various packages with R. 

This analysis is completed as an exercise from Lang and Nolan's `Data Science in R: A Case Studies Approach to Computation Reasoning and Problem Solving` Chapter 2. The report compares the age distributions of the runners age across all 14 years of races, and evaluates how the distributions change over the years. 

# Methods
The steps used for this analysis are: data aqusition, data cleansing and transformation, exploratory data analysis, visualization, and lastly, linear regression. Details of these steps are outlined below. 

## Data Aquisition
The first step in performing any statistical analysis is identifying and importing relevant data. The Cherry Blossom website hosts a single endpoint for participant data by year by gender, meaning a total of 28 websites were scraped for this analysis. In order to iterate through the endpoints, the R functions `htmlParse`, `getNodeSet`, `xmlValue`, and `strsplit` in conjuction with `m/sapply` were leveraged within two large functions called `extractResTable` and `extractResTableWomen` to extract both male and female ages, respectively, from the Cherry Blossom website. [2] Data extraction did not stop at the API calls to the website, ample data cleaning was the next hurdle in analysis. 

## Data Cleaning and Transformation
Extracting data into an analytical envoirnment was only the first step. In order to continue with analysis, substantial data cleaning needed to occur. The extract data was not stored in a traditional tabular format; instead it was loaded in chunks of data by year, odd character values begun and ended every line, headers spanned multiple rows -- making it difficult to automate the extraction of important data elements. This element of analysis was particularly challenging as custom functions were required to properly format the data. Moreover, the format for the male and female data differed, meaning two seperate customized functions were built to properly construct a dataframe for analysis. Sparing the reader code excerpts, an indepth walkthrough of the customized data cleansing functions can be found in the appendix. 

Other data cleansing priorities were placed on conducting a date/time transformation to the runners' race time, as well as properly assigning the right data types to required fields. For the purposes of this report, we focus on the year and age of each runner. The next step is to sift through the cleaned data to identify any patterns and anomalies (nulls, data entry errors, etc.).

## Exploratory Data Analysis and Visualizations
A null check was performed across the data frame, and any row containing null data was removed from the population explored within this paper. In order to optimize the run time of the future analysis, simplified data frames were created only consisting of the age and year of each participant. Due to the nature of the question evaluated, no other data points from the original data set were needed. 

Upon creating our simiplified data frame, the validity of our participants were examined. Data inconsistencies recorded for male participants ranged from ages as young as 1 year of age, to as old as 89. When these participants are represented visually, they were identified as outliers from the population. In order to provide a generalizable conclusion to our research question and due to our large sample size, this analysis only considers participants from ages 18-70 for males, and 18-60 for females. In the figures below, the outliers for the male and female populations are explicit. 

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.1.png}
\caption{Male Participant Ages by Year with Outliers}
\label{fig:1}
\end{figure}



\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.2.png}
\caption{Female Participant Ages by Year with Outliers}
\label{fig:2}
\end{figure}

Notice the age range differences between male and female participants over the years, this difference led to the exclusion of different age ranges based on distinct population distributions. The exclusion of the outliers identified visually in figures 1 and 2, lead to a population decrease of 759 for males, and 412 for females. 

Refining our population, the following analysis focuses on extracting generalizable trends for both male and female populations in addition to the combined population from 1999 to 2012. 

# Results

The analysis is conducted by examining QQ plots, boxplots, density plots, and performing linear regression to detect the rate of change. The findings in general conclude with the null hypothesis of the report, the participants in 1999 were older than those in 2012.

## QQ Plots 

Below we show the quantiles for the years 1999 and 2012 for the combined set. We observe that the 50th percentile of all participants in 2012 are four years younger than those that participated in 1999.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.5.png}
\caption{Runner's Age Comparison for Years 1999 vs 2012}
\label{fig:5}
\end{figure}

However, when we separate the data between male and female, we see the 50th percentile of male runners goes from 40 to 35.5 years old, while the female runners go from 33 to 31 years old. 

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.6.png}
\caption{Male Runner's Age Comparison for Years 1999 vs 2012}
\label{fig:6}
\end{figure}


\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.7.png}
\caption{Female Runner's Age Comparison for Years 1999 vs 2012}
\label{fig:7}
\end{figure}


## Box Plots
Is the difference in the runners' age between 1999 and 2012 is just an isolated case or is a trend? In the boxplot below we have the runners' age distribution for all 14 years. The plots visually indicate a gradual change over the years towards a younger age.


\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.8.png}
\caption{Runner's Age by Year}
\label{fig:8}
\end{figure}

## Density Plots
In the visual inspection of the age density charts for all 14 years, we appreciate how the shape of the density starts to shift from 1999, where there is almost a flat line between 30 and 45, to 2009 where the shape peaks between 25 and 30 years old. One thing to notice is that 2009 has the youngest participants of these 14 years. The salmon vertical line depicted here is the mean age of the population for that year, whereas the blue line is the median. The distinction between the mean and median also ensures outliers do not skew the mean represented. 

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.9.png}
\caption{Age Density by Year for All Runners}
\label{fig:9}
\end{figure}


When we split the data by gender, we can see that that female runners are always younger than their male counterparts across the 14 year period. Male runners have a gradually shift in age from 38 to 40 years old in 1999 to a peak between 27 and 31 years old in 2012. However, female participants seem to increase the participation of younger runners while keeping the other age groups about the same, we see that on the peak shapes increases around the same age group across all 14 years.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.10.png}
\caption{Age Density by Year and Gender}
\label{fig:10}
\end{figure}


## Summary Statistics
Below are sets of summary statistics to provide numerical values to the graphics displayed above. The below summary statistics table overlays a heatmap on values that have the greatest difference from the rest of the data set. You can see now both with numerical values and the intensity of the green on the heat map that years 2009 and 2010 have the youngest mean and median for the combined runner population. 

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.14.png}
\caption{Summary Statistics of Combined Population}
\label{fig:11}
\end{figure}

Looking distinctly at the male running population, you see the youngest mean and median population at 36.99 and 35 respectively in year 2010. You see a three year decrease in the mean from 1999 to 2012. 

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.13.png}
\caption{Summary Statistics of Male Population}
\label{fig:11}
\end{figure}

Looking distinctly at the female running population, you see the youngest mean and median population in 2009. 

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.12.png}
\caption{Summary Statistics of Female Population}
\label{fig:11}
\end{figure}

## Linear Regression
In order to quantify the rate of change for age in the Cherry Blossom race, simple linear regression techniques were leveraged. Due to the population size of our analysis, we will leverage the central limit theorem to ensure all assumptions are met, and assume each sample is linearly independent.  

We have fitted a linear model to give us the rate of change through the years. The linear model can mathematically be represented: $$age_{runners} = 576.72 - 0.269 year.$$ 

The linear model for all runners shows that for each year's increment we see an average decrease of 3.2 months (0.269 years) in the participants age. The slope of the regression does not have practical meaning and is not integral to this analysis. Below is a visual representation of the decrease in population age over the years. The black dots represent each participant for the year they participated. 

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.3.png}
\caption{Linear Regression on General Population}
\label{fig:3}
\end{figure}


The multiple linear model confirms what is seen on the density plots that the age in the female runners decrease at a lower pace than their male counterparts. The linear models can be mathematical representated: 
$$age_{male} = 627.75 - 0.293 year$$ and $$age_{female} = 299.84 - 0.132 year.$$  

For each year increase the female runners age decreases in average 1.6 months (0.132 years), while their male counterpart decreases 3.5 months (0.293 years) in participant’s age each year increase. The slope does not have a practical meaning and is not integral to this analysis. 

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{cs2.4.png}
\caption{Multiple Linear Regression by Gender}
\label{fig:4}
\end{figure}

The blue line represents the male population and the salmon line represents the female population. It is visually apparent that the male population age decrease is steeper than that of the female population. 

# Conclusion
In conclusion, the distributions of all runners, male and female runners shift over the years 1999 to 2012. In general, runners' ages decrease as the years progress. In 2009 there was the greatest change in mean and median age for female runners, and in 2010 there was the greatest change in mean and median age for male runners. The decrease in age has been a gradual shift overall, however, the male runners showcase a more dramatic shift in comparision to their female counterparts. 

Future analysis of the children and young adult population would be interesting to examine. Volumes within of these populations increase 3x toward the latter years within our analysis. This volume increase is also present in our runner population, but not as drastic.  

# Resources
[1] D. Lang and D. Nolan, Data Science in R: A Case Studies Approach to Computation Reasoning and Problem Solving. New York, New York: CRC Press.

[2] "Credit Union: Cherry Blossom Ten Mile Run and 5K Run-Walk," Credit Union Cherry Blossom, [Online]. 2018. Available: http://www.cherryblossom.org [Accessed: 18-September-2019].


# Appendix 
All code for this report can be found at the following GitHub repository: https://github.com/samanthasprague/MSDS7333. For any questions related to the code please contact: ssprague@smu.edu, ecantumedellin@smu.edu, or sgarciadealford@mail.smu.edu. 

